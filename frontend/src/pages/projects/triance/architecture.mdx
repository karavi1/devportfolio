import Head from 'next/head'
import Navbar from '@/components/Navbar'
import Mermaid from '@/components/Mermaid'

export const meta = {
  title: 'Triance Architecture',
  subtitle: 'Context, data model, and hot paths',
}

<>
  <Head>
    <title>{`${meta.title} | Kaushik Ravi`}</title>
  </Head>
  <Navbar />
  <main className="px-6 md:px-10 lg:px-16">
    <section className="mx-auto max-w-4xl py-10">
      <h1 className="text-3xl md:text-4xl font-bold">{meta.title}</h1>
      <p className="mt-2 text-gray-600">{meta.subtitle}</p>

      <article className="prose prose-slate max-w-none dark:prose-invert mt-6">

        <h2>System Context</h2>
        <Mermaid chart={`
flowchart LR
  user(("User")) -->|HTTPS| fe["React (triance.app)"]
  fe --> api["FastAPI (EC2)"]
  api --> rds["Amazon RDS (Postgres)"]
  api --> cw["CloudWatch Logs/Metrics"]
`} />


        <h2 className="mt-8">Data Models</h2>
        <Mermaid chart={`
erDiagram
  AUTH_USER ||--o{ WORKOUTS : owns
  AUTH_USER ||--o{ EXERCISES : owns
  WORKOUTS ||--|{ LOGGED_EXERCISES : has
  EXERCISES ||--o{ LOGGED_EXERCISES : referenced_by

  AUTH_USER {
    uuid id PK
    string username
    optional[string] email
    optional[string] full_name
    optional[bool] disabled
    string hashed_password
    bool is_admin
  }

  WORKOUTS {
    uuid id PK
    uuid user_id FK
    datetime created_time
    optional[string] notes
    list[LOGGED_EXERCISES] logged_exercises
    ExerciseGroup workout_type
    AuthUser user
  }

  EXERCISES {
    uuid id PK
    uuid user_id FK
    string name
    ExerciseGroup category
    list[string] primary_muscles
    Optional[list[string]] secondary_muscles
    Optional[string] description
    AuthUser user 
  }

  LOGGED_EXERCISES {
    uuid id PK
    int set_no
    int reps
    float weight
    uuid workout_id FK
    uuid exercise_id FK
  }
`} />

      <h2 className="mt-8">Sequence Diagrams </h2>

      <h3 className="mt-8">Create Auth User</h3>
      <Mermaid chart={`
sequenceDiagram
  participant U as User
  participant FE as React
  participant BE as FastAPI
  participant DB as Postgres

  U->>FE: Submit user creation form
  FE->>BE: POST /api/users
  BE->>DB: INSERT user
  DB-->>BE: IDs
  BE-->>FE: 201 Created
  FE-->>U: Success + redirect to hub with user information!
`} />


      <h3 className="mt-8">Create Workout</h3>
      <Mermaid chart={`
sequenceDiagram
  participant U as User
  participant FE as React
  participant BE as FastAPI
  participant DB as Postgres

  U->>FE: Submit workout form
  FE->>BE: POST /api/workouts
  BE->>DB: INSERT workout + sets
  DB-->>BE: IDs
  BE-->>FE: 201 Created
  FE-->>U: Success + redirect
`} />

      <h3 className="mt-8">Update Workout</h3>
      <Mermaid chart={`
sequenceDiagram
  participant U as User
  participant FE as React
  participant BE as FastAPI
  participant DB as Postgres

  U->>FE: Dropdown Workouts
  FE->>BE: GET /api/workouts/{workout_id}
  BE->>DB: FETCH workout
  DB->>BE: workout struct
  BE->>FE: 200 + workout struct
  FE->>U: Success + workout selection
  U->>FE: Submit Update workout form
  FE->>BE: PATCH /api/workouts/{workout_id}
  BE->>DB: INSERT workout + sets
  DB-->>BE: IDs
  BE-->>FE: 201 Created
  FE-->>U: Success + redirect
`} />

      </article>
    </section>
  </main>
</>